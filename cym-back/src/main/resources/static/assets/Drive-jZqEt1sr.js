import{r as f,B as z,I as T,J as k,u as E,K as V,m as e,q as D,v as I,x as N,z as m,C as M,D as U,j as $,k as F,E as q,h as A,o as H,l as B,L,F as j,H as P,G as R}from"./index-CHaRzVd8.js";import{H as O}from"./Header-CZu9RGU-.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";const w=a=>(M("data-v-682af617"),a=a(),U(),a),G=w(()=>e("button",{type:"button",class:"btn btn-outline-secondary btn-sm"},[e("i",{class:"bi bi-pencil-square"})],-1)),J={class:"align-items-center justify-content-center"},K=w(()=>e("div",{class:"row w-100 text-center mb-3"},[e("p",{style:{"font-size":"1.1rem","font-weight":"bold"}},"파일수정")],-1)),Q=["onSubmit"],W={class:"form-group mb-3"},X=w(()=>e("label",{for:"title",class:"px-2",style:{"font-size":"0.9rem"}},"제목",-1)),Y={class:"form-group mb-3"},Z=w(()=>e("label",{for:"file",class:"px-2",style:{"font-size":"0.9rem"}},"파일첨부",-1)),ee={class:"px-2",style:{"font-size":".8rem"}},te={class:"px-2",style:{"font-size":".8rem"}},oe={class:"row button-group d-flex justify-content-center mb-2"},se=["onClick"],le=w(()=>e("button",{type:"submit",class:"btn btn-secondary submit-button col-3",style:{"border-radius":"20px","font-size":"0.9rem","background-color":"#7248BD"}}," 등록 ",-1)),ne={__name:"FileModifyBtn",props:{file:Object},emits:["fileModified"],setup(a,{emit:v}){const l=a,c=f(l.file.postTitle),i=f(l.file.size),d=f(l.file.fileName),r=f(l.file.fileName),n=f(null),h=v,y=localStorage.getItem("token"),g=s=>{n.value=s.target.files[0],n.value&&(i.value=(n.value.size/(1024*1024)).toFixed(2),r.value=n.value.name)},u=s=>(s/(1024*1024)).toFixed(3),p=async s=>{const t=new FormData;t.append("postTitle",c.value),t.append("originalFilename",d.value),t.append("file",n.value);const b={postTitle:c.value,fileName:n.value?n.value.name:d.value,size:n.value?u(n.value.size):i.value};try{const x=await $.put("/v1/drive/edit",t,{headers:{Authorization:`Bearer ${y}`}});console.log(x.data.message),o(),h("fileModified",{originalFileName:d,newFileData:b}),s()}catch(x){console.log(c.value),console.error("파일 수정 오류:",x)}},_=s=>{p(s)},o=()=>{i.value=0,file.value=null;const s=document.getElementById("file");s&&(s.value=null)};return(s,t)=>(z(),T(E(V),{arrow:""},{content:k(({close:b})=>[e("div",J,[K,e("form",{onSubmit:D(x=>_(b),["prevent"])},[e("div",W,[X,I(e("input",{type:"text",class:"w-75",style:{"font-size":"0.9rem"},id:"title","onUpdate:modelValue":t[0]||(t[0]=x=>c.value=x),required:""},null,512),[[N,c.value]])]),e("div",Y,[Z,e("input",{type:"file",style:{"font-size":"0.9rem"},id:"file",onChange:g},null,32),e("p",ee,"현재 파일: "+m(r.value),1),e("p",te,"현재 "+m(i.value)+"MB / (첨부파일 : 30MB로 제한)",1)]),e("div",oe,[e("button",{type:"button",onClick:b,class:"btn btn-secondary cancel-button col-3 mx-3",style:{"border-radius":"20px","font-size":"0.9rem"}}," 취소 ",8,se),le])],40,Q)])]),default:k(()=>[G]),_:1}))}},ae=C(ne,[["__scopeId","data-v-682af617"]]),ie=a=>(M("data-v-f6d27b69"),a=a(),U(),a),ce=ie(()=>e("i",{class:"bi bi-trash"},null,-1)),re=[ce],de={__name:"FileDeleteBtn",props:{file:Object},emits:["fileDeleted"],setup(a,{emit:v}){const l=a,c=v,i=localStorage.getItem("token"),d=l.file.fileName,r=async()=>{try{const n=await $.delete("/v1/drive/delete",{params:{filename:l.file.fileName},headers:{Authorization:`Bearer ${i}`}});console.log(n.data.message),c("fileDeleted",d)}catch(n){console.log(l.file.fileName),console.log("Token:",i),console.error("파일 삭제 오류:",n)}};return(n,h)=>(z(),F("button",{type:"button",class:"btn btn-outline-secondary btn-sm",onClick:h[0]||(h[0]=y=>r())},re))}},ue=C(de,[["__scopeId","data-v-f6d27b69"]]),fe={type:"button",class:"btn btn-secondary mx-4",style:{"border-radius":"20px","background-color":"#7248BD"},ref:"triggerButton"},me={class:"align-items-center justify-content-center"},pe=e("div",{class:"row w-100 text-center mb-3"},[e("p",{style:{"font-size":"1.1rem","font-weight":"bold"}},"파일등록")],-1),_e=["onSubmit"],ve={class:"form-group mb-3"},he=e("label",{for:"title",class:"px-2",style:{"font-size":"0.9rem"}},"제목",-1),be={class:"form-group mb-3"},ye=e("label",{for:"file",class:"px-2",style:{"font-size":"0.9rem"}},"파일첨부",-1),ge={class:"px-2",style:{"font-size":".8rem"}},xe={class:"row button-group d-flex justify-content-center mb-2"},ze=["onClick"],$e=e("button",{type:"submit",class:"btn btn-secondary submit-button col-3",style:{"border-radius":"20px","font-size":"0.9rem","background-color":"#7248BD"}}," 등록 ",-1),we={__name:"FileUploadBtn",emits:["fileUploaded"],setup(a,{emit:v}){const l=v,c=localStorage.getItem("token"),i=f(""),d=f(0),r=f(null),n=u=>{r.value=u.target.files[0],r.value&&(d.value=(r.value.size/(1024*1024)).toFixed(2))},h=async u=>{const p=new FormData;p.append("file",r.value),p.append("title",i.value);try{const _=await $.post("/v1/drive/upload",p,{headers:{Authorization:`Bearer ${c}`}});console.log(_.data.message),g(),l("fileUploaded"),u()}catch(_){console.error("파일 업로드 오류:",_)}},y=u=>{h(u)},g=()=>{i.value="",d.value=0,r.value=null;const u=document.getElementById("file");u&&(u.value=null)};return(u,p)=>(z(),T(E(V),{arrow:""},{content:k(({close:_})=>[e("div",me,[pe,e("form",{onSubmit:D(o=>y(_),["prevent"])},[e("div",ve,[he,I(e("input",{type:"text",class:"w-75",style:{"font-size":"0.9rem"},id:"title","onUpdate:modelValue":p[0]||(p[0]=o=>i.value=o),required:""},null,512),[[N,i.value]])]),e("div",be,[ye,e("input",{type:"file",style:{"font-size":"0.9rem"},id:"file",onChange:n,required:""},null,32),e("p",ge,"현재 "+m(d.value)+"MB / (첨부파일 : 30MB로 제한)",1)]),e("div",xe,[e("button",{type:"button",onClick:_,class:"btn btn-secondary cancel-button col-3 mx-3",style:{"border-radius":"20px","font-size":"0.9rem"}}," 취소 ",8,ze),$e])],40,_e)])]),default:k(()=>[e("button",fe," 파일등록 ",512)]),_:1}))}},S=a=>(M("data-v-cc2fa503"),a=a(),U(),a),Be={class:"container-fluid"},Fe=S(()=>e("div",{class:"m-3 mt-4"},[e("p",{class:"fw-bold fs-3"},"통합 자료실")],-1)),ke={class:"row d-flex align-items-center justify-content-between m-3"},Se={class:"col-md-6 col-lg-4 d-flex mt-3 mb-3 mx-6 justify-content-end"},De={class:"justify-content-start m-3"},Ie={class:"row-col-4 d-flex align-items-center m-3"},Ne=S(()=>e("p",{class:"col-1",style:{"font-size":".8rem","margin-bottom":"0"}},"자료실 사용량",-1)),Me={class:"col-3 text-end",style:{"font-size":".8rem","margin-bottom":"0"}},Ue={class:"progress col-4 m-3",role:"progressbar","aria-label":"통합 자료실 사용량","aria-valuenow":"usagePercentage","aria-valuemin":"0","aria-valuemax":"100"},Ce={class:"px-1",style:{"font-size":".8rem"}},je={class:"container m-3 d-flex"},Te={class:"table table-hover table-bordered"},Ee=S(()=>e("thead",{class:"table-head"},[e("tr",null,[e("th",{scope:"col"}),e("th",{scope:"col"},"제목"),e("th",{scope:"col"},"파일명"),e("th",{scope:"col"},"파일 크기"),e("th",{scope:"col"},"업로더 아이디"),e("th",{scope:"col"},"등록자"),e("th",{scope:"col"},"등록일시"),e("th",{scope:"col"},"수정"),e("th",{scope:"col"},"삭제")])],-1)),Ve=["href"],qe=S(()=>e("i",{class:"bi bi-download px-1"},null,-1)),Ae={__name:"Drive",setup(a){const v=localStorage.getItem("token");q(),A();const l=f([]),c=f(""),i=f([]),d=f(0),r=f(0),n=async()=>{if(console.log(c.value),c.value.length>0)try{const o=await $.get("/v1/drive/search",{params:{searchBody:c.value},headers:{Authorization:`Bearer ${v}`}});i.value=o.data.content,l.value=i.value}catch(o){console.error("Error fetching search results:",o)}else i.value=[]},h=async({originalFileName:o,newFileData:s})=>{const t=l.value.findIndex(b=>b.fileName===o.value);console.log(o.value),t!==-1?(l.value[t]={...l.value[t],postTitle:s.postTitle,fileName:s.fileName,size:s.size},console.log(l.value[t])):console.error("File not found")},y=async o=>{l.value=l.value.filter(s=>s.fileName!==o.value)},g=async()=>{try{const o=await $.get("/v1/drive/list",{headers:{Authorization:`Bearer ${v}`}});l.value=o.data.content,p(),_()}catch(o){console.error("Error fetching data:",o)}};H(g);const u=o=>{const s={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"};return new Date(o).toLocaleDateString(void 0,s)},p=()=>{d.value=l.value.reduce((o,s)=>o+s.size,0).toFixed(3),console.log(d.value)},_=()=>{const o=parseFloat(d.value);r.value=(o/10*100).toFixed(2),console.log(r.value)};return(o,s)=>(z(),F(j,null,[B(O),e("div",Be,[Fe,e("div",ke,[e("form",{onSubmit:D(n,["prevent"]),class:"input-group col-md-6 col-lg-4 mt-3 mb-3",role:"search",style:{width:"300px"}},[I(e("input",{type:"search",class:"form-control",placeholder:"Search...","aria-label":"Search","onUpdate:modelValue":s[0]||(s[0]=t=>c.value=t)},null,512),[[N,c.value]]),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:n},"검색")],32),e("div",Se,[B(we,{onFileUploaded:g})])]),e("div",De,[e("div",Ie,[Ne,e("p",Me,m(d.value)+" MB / 10 MB",1)]),e("div",Ue,[e("div",{class:"progress-bar",style:L({width:r.value+"%",backgroundColor:"#7248BD"})},null,4),e("p",Ce,m(r.value)+"%",1)])]),e("div",je,[e("table",Te,[Ee,e("tbody",null,[(z(!0),F(j,null,P(l.value,(t,b)=>(z(),F("tr",{key:t.id},[e("td",null,m(b+1),1),e("td",null,m(t.postTitle),1),e("td",null,[e("a",{href:t.fileUrl,class:"download-link"},[qe,R(m(t.fileName),1)],8,Ve)]),e("td",null,m(t.size)+"MB",1),e("td",null,m(t.id),1),e("td",null,m(t.username),1),e("td",null,m(u(t.uploadDate)),1),e("td",null,[B(ae,{file:t,onFileModified:h},null,8,["file"])]),e("td",null,[B(ue,{file:t,onFileDeleted:y},null,8,["file"])])]))),128))])])])])],64))}},Re=C(Ae,[["__scopeId","data-v-cc2fa503"]]);export{Re as default};
